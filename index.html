<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="JALS冠動脈疾患リスクスコア計算アプリ">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkpBTFMg5관5YuV6ISI55ar5oKj5oKj55ar44Oq44K544Kv44K544Kz44KiIiwKICAic2hvcnRfbmFtZSI6ICJKQU1TIOODquOCueOCr+OCueOCs+OCog==,CiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwKICAidGhlbWVfY29sb3IiOiAiIzNiODJmNiIsCiAgImljb25zIjogW10KfQ==">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%233b82f6' width='100' height='100'/%3E%3Cpath fill='%23fff' d='M50 25c-8 0-15 3-20 8l-5-5c6-6 14-10 25-10s19 4 25 10l-5 5c-5-5-12-8-20-8zm0 15c-5 0-9 2-12 5l-5-5c4-4 9-7 17-7s13 3 17 7l-5 5c-3-3-7-5-12-5zm0 10a7 7 0 100 14 7 7 0 000-14z'/%3E%3C/svg%3E">
    <title>JALS 冠動脈疾患リスクスコア計算</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // PWA インストール対応
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        // Lucide React アイコンの代替（シンプルなSVG）
        const Heart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
        );

        const Info = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        );

        const RotateCcw = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const Calculator = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                <line x1="8" y1="6" x2="16" y2="6"></line>
                <line x1="8" y1="10" x2="16" y2="10"></line>
                <line x1="8" y1="14" x2="16" y2="14"></line>
                <line x1="8" y1="18" x2="16" y2="18"></line>
            </svg>
        );

        const Download = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        function JALSRiskCalculator() {
            const [formData, setFormData] = useState({
                age: '',
                gender: 'male',
                sbp: '',
                ldl: '',
                hdl: '',
                smoking: false,
                diabetes: false
            });
            
            const [result, setResult] = useState(null);
            const [showGuideline, setShowGuideline] = useState(false);
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);

            useEffect(() => {
                // PWAインストール可能かチェック
                const checkInstallable = () => {
                    if (deferredPrompt && !window.matchMedia('(display-mode: standalone)').matches) {
                        setShowInstallPrompt(true);
                    }
                };
                
                window.addEventListener('beforeinstallprompt', checkInstallable);
                checkInstallable();
                
                return () => window.removeEventListener('beforeinstallprompt', checkInstallable);
            }, []);

            const handleInstall = async () => {
                if (!deferredPrompt) {
                    alert('ブラウザのメニュー（右上の3点アイコン）から「ホーム画面に追加」を選択してください。');
                    return;
                }
                
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    setShowInstallPrompt(false);
                }
                deferredPrompt = null;
            };

            const calculateSuitaScore = () => {
                const age = parseInt(formData.age);
                const sbp = parseInt(formData.sbp);
                const ldl = parseInt(formData.ldl);
                const hdl = parseInt(formData.hdl);
                
                let score = 0;
                
                // 年齢スコア
                if (formData.gender === 'male') {
                    if (age >= 35 && age <= 44) score += 20;
                    else if (age >= 45 && age <= 54) score += 40;
                    else if (age >= 55 && age <= 64) score += 60;
                    else if (age >= 65 && age <= 69) score += 70;
                } else {
                    if (age >= 35 && age <= 44) score += 0;
                    else if (age >= 45 && age <= 54) score += 15;
                    else if (age >= 55 && age <= 64) score += 35;
                    else if (age >= 65 && age <= 69) score += 50;
                }
                
                // 血圧スコア
                if (sbp < 120) score += 0;
                else if (sbp >= 120 && sbp <= 139) score += 5;
                else if (sbp >= 140 && sbp <= 159) score += 10;
                else if (sbp >= 160 && sbp <= 179) score += 15;
                else if (sbp >= 180) score += 20;
                
                // LDLコレステロールスコア
                if (ldl < 100) score += 0;
                else if (ldl >= 100 && ldl <= 139) score += 5;
                else if (ldl >= 140 && ldl <= 159) score += 10;
                else if (ldl >= 160 && ldl <= 179) score += 15;
                else if (ldl >= 180) score += 20;
                
                // HDLコレステロールスコア
                if (hdl >= 60) score += 0;
                else if (hdl >= 40 && hdl <= 59) score += 5;
                else if (hdl < 40) score += 10;
                
                // 喫煙
                if (formData.smoking) score += 10;
                
                // 糖尿病
                if (formData.diabetes) score += 15;
                
                // リスク評価
                let riskLevel = '';
                let riskPercentage = 0;
                let riskColor = '';
                let recommendation = '';
                
                if (score < 35) {
                    riskLevel = '低リスク';
                    riskPercentage = 2;
                    riskColor = 'bg-green-500';
                    recommendation = '生活習慣の維持を継続してください。定期的な健診を受けましょう。';
                } else if (score >= 35 && score <= 54) {
                    riskLevel = '中リスク';
                    riskPercentage = 5;
                    riskColor = 'bg-yellow-500';
                    recommendation = '生活習慣の改善が推奨されます。必要に応じて薬物療法を検討してください。';
                } else if (score >= 55 && score <= 74) {
                    riskLevel = '高リスク';
                    riskPercentage = 9;
                    riskColor = 'bg-orange-500';
                    recommendation = '積極的な生活習慣改善と薬物療法の開始を強く推奨します。';
                } else {
                    riskLevel = '超高リスク';
                    riskPercentage = 15;
                    riskColor = 'bg-red-600';
                    recommendation = '直ちに専門医への紹介と包括的な治療介入が必要です。';
                }
                
                setResult({
                    score,
                    riskLevel,
                    riskPercentage,
                    riskColor,
                    recommendation
                });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                calculateSuitaScore();
            };

            const handleReset = () => {
                setFormData({
                    age: '',
                    gender: 'male',
                    sbp: '',
                    ldl: '',
                    hdl: '',
                    smoking: false,
                    diabetes: false
                });
                setResult(null);
                setShowGuideline(false);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-2xl mx-auto">
                        {/* インストールプロンプト */}
                        {showInstallPrompt && (
                            <div className="bg-blue-600 text-white rounded-2xl shadow-lg p-4 mb-6 flex items-center justify-between">
                                <div className="flex-1">
                                    <div className="font-semibold mb-1">ホーム画面に追加</div>
                                    <div className="text-sm opacity-90">アプリのように使えます</div>
                                </div>
                                <button
                                    onClick={handleInstall}
                                    className="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors flex items-center gap-2"
                                >
                                    <Download size={18} />
                                    追加
                                </button>
                            </div>
                        )}

                        {/* ヘッダー */}
                        <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div className="flex items-center gap-3 mb-2">
                                <Heart size={32} className="text-red-500" />
                                <h1 className="text-2xl font-bold text-gray-800">JALS 冠動脈疾患リスクスコア</h1>
                            </div>
                            <p className="text-sm text-gray-600">日本動脈硬化学会 吹田スコア</p>
                        </div>

                        {/* 入力フォーム */}
                        <form onSubmit={handleSubmit} className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <h2 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                <Calculator size={20} />
                                患者情報入力
                            </h2>

                            {/* 性別 */}
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">性別</label>
                                <div className="flex gap-4">
                                    <label className="flex items-center">
                                        <input
                                            type="radio"
                                            value="male"
                                            checked={formData.gender === 'male'}
                                            onChange={(e) => setFormData({...formData, gender: e.target.value})}
                                            className="mr-2"
                                        />
                                        <span className="text-gray-700">男性</span>
                                    </label>
                                    <label className="flex items-center">
                                        <input
                                            type="radio"
                                            value="female"
                                            checked={formData.gender === 'female'}
                                            onChange={(e) => setFormData({...formData, gender: e.target.value})}
                                            className="mr-2"
                                        />
                                        <span className="text-gray-700">女性</span>
                                    </label>
                                </div>
                            </div>

                            {/* 年齢 */}
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    年齢 (35-69歳)
                                </label>
                                <input
                                    type="number"
                                    value={formData.age}
                                    onChange={(e) => setFormData({...formData, age: e.target.value})}
                                    min="35"
                                    max="69"
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="例: 55"
                                />
                            </div>

                            {/* 収縮期血圧 */}
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    収縮期血圧 (mmHg)
                                </label>
                                <input
                                    type="number"
                                    value={formData.sbp}
                                    onChange={(e) => setFormData({...formData, sbp: e.target.value})}
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="例: 130"
                                />
                            </div>

                            {/* LDLコレステロール */}
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    LDLコレステロール (mg/dL)
                                </label>
                                <input
                                    type="number"
                                    value={formData.ldl}
                                    onChange={(e) => setFormData({...formData, ldl: e.target.value})}
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="例: 120"
                                />
                            </div>

                            {/* HDLコレステロール */}
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    HDLコレステロール (mg/dL)
                                </label>
                                <input
                                    type="number"
                                    value={formData.hdl}
                                    onChange={(e) => setFormData({...formData, hdl: e.target.value})}
                                    required
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="例: 50"
                                />
                            </div>

                            {/* チェックボックス */}
                            <div className="mb-4 space-y-2">
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={formData.smoking}
                                        onChange={(e) => setFormData({...formData, smoking: e.target.checked})}
                                        className="mr-2 w-4 h-4"
                                    />
                                    <span className="text-gray-700">喫煙あり</span>
                                </label>
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={formData.diabetes}
                                        onChange={(e) => setFormData({...formData, diabetes: e.target.checked})}
                                        className="mr-2 w-4 h-4"
                                    />
                                    <span className="text-gray-700">糖尿病あり</span>
                                </label>
                            </div>

                            {/* ボタン */}
                            <div className="flex gap-3">
                                <button
                                    type="submit"
                                    className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2"
                                >
                                    <Calculator size={20} />
                                    計算する
                                </button>
                                <button
                                    type="button"
                                    onClick={handleReset}
                                    className="px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition-colors"
                                >
                                    <RotateCcw size={20} />
                                </button>
                            </div>
                        </form>

                        {/* 結果表示 */}
                        {result && (
                            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                                <h2 className="text-lg font-semibold text-gray-800 mb-4">評価結果</h2>
                                
                                {/* スコア表示 */}
                                <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-4">
                                    <div className="text-center mb-4">
                                        <div className="text-5xl font-bold text-blue-600 mb-2">{result.score}</div>
                                        <div className="text-sm text-gray-600">吹田スコア</div>
                                    </div>
                                    
                                    <div className={`${result.riskColor} text-white rounded-lg p-4 text-center mb-3`}>
                                        <div className="text-xl font-bold mb-1">{result.riskLevel}</div>
                                        <div className="text-sm">10年間の冠動脈疾患発症リスク: 約{result.riskPercentage}%</div>
                                    </div>
                                    
                                    <div className="bg-white rounded-lg p-4 border-l-4 border-blue-500">
                                        <div className="font-medium text-gray-800 mb-2">推奨事項</div>
                                        <div className="text-sm text-gray-700">{result.recommendation}</div>
                                    </div>
                                </div>

                                {/* ガイドライン表示ボタン */}
                                <button
                                    onClick={() => setShowGuideline(!showGuideline)}
                                    className="w-full bg-indigo-50 text-indigo-700 py-3 rounded-lg font-medium hover:bg-indigo-100 transition-colors flex items-center justify-center gap-2"
                                >
                                    <Info size={20} />
                                    {showGuideline ? 'ガイドラインを閉じる' : 'ガイドライン・計算根拠を表示'}
                                </button>
                            </div>
                        )}

                        {/* ガイドライン詳細 */}
                        {showGuideline && (
                            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                                <h2 className="text-lg font-semibold text-gray-800 mb-4">JALSガイドライン・計算根拠</h2>
                                
                                <div className="space-y-4 text-sm">
                                    <div>
                                        <h3 className="font-semibold text-gray-800 mb-2">◆ 吹田スコアについて</h3>
                                        <p className="text-gray-700">
                                            日本動脈硬化学会が開発した日本人のための冠動脈疾患リスク評価ツールです。
                                            大阪府吹田市のコホート研究に基づき、35-69歳の日本人を対象としています。
                                        </p>
                                    </div>

                                    <div>
                                        <h3 className="font-semibold text-gray-800 mb-2">◆ スコアリング項目と配点</h3>
                                        <div className="bg-gray-50 rounded-lg p-4 space-y-2 text-xs">
                                            <div>
                                                <div className="font-medium text-gray-800">年齢（男性/女性）</div>
                                                <div className="text-gray-600 ml-4">
                                                    • 35-44歳: 20/0点<br/>
                                                    • 45-54歳: 40/15点<br/>
                                                    • 55-64歳: 60/35点<br/>
                                                    • 65-69歳: 70/50点
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <div className="font-medium text-gray-800">収縮期血圧</div>
                                                <div className="text-gray-600 ml-4">
                                                    • &lt;120: 0点 / 120-139: 5点<br/>
                                                    • 140-159: 10点 / 160-179: 15点<br/>
                                                    • ≥180: 20点
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <div className="font-medium text-gray-800">LDLコレステロール</div>
                                                <div className="text-gray-600 ml-4">
                                                    • &lt;100: 0点 / 100-139: 5点<br/>
                                                    • 140-159: 10点 / 160-179: 15点<br/>
                                                    • ≥180: 20点
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <div className="font-medium text-gray-800">HDLコレステロール</div>
                                                <div className="text-gray-600 ml-4">
                                                    • ≥60: 0点 / 40-59: 5点 / &lt;40: 10点
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <div className="font-medium text-gray-800">喫煙: 10点 / 糖尿病: 15点</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="font-semibold text-gray-800 mb-2">◆ リスク分類</h3>
                                        <div className="space-y-1 text-xs">
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-green-500 rounded"></div>
                                                <span className="text-gray-700">低リスク（&lt;35点）: 10年リスク約2%</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-yellow-500 rounded"></div>
                                                <span className="text-gray-700">中リスク（35-54点）: 10年リスク約5%</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-orange-500 rounded"></div>
                                                <span className="text-gray-700">高リスク（55-74点）: 10年リスク約9%</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <div className="w-3 h-3 bg-red-600 rounded"></div>
                                                <span className="text-gray-700">超高リスク（≥75点）: 10年リスク約15%</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="font-semibold text-gray-800 mb-2">◆ 管理目標値</h3>
                                        <div className="bg-blue-50 rounded-lg p-3 text-xs">
                                            <p className="text-gray-700">
                                                <strong>中リスク以上の場合:</strong><br/>
                                                • LDL-C &lt;120 mg/dL<br/>
                                                • 血圧 &lt;130/80 mmHg<br/>
                                                • 禁煙<br/>
                                                • 糖尿病管理（HbA1c &lt;7.0%）
                                            </p>
                                        </div>
                                    </div>

                                    <div className="text-xs text-gray-500 border-t pt-3">
                                        <p>
                                            参考: 日本動脈硬化学会「動脈硬化性疾患予防ガイドライン2022年版」<br/>
                                            本アプリは臨床判断の補助ツールです。最終的な診断・治療方針は臨床医の判断に委ねられます。
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ヘルプテキスト */}
                        <div className="bg-blue-50 rounded-xl p-4 text-sm text-gray-700 text-center">
                            <p className="mb-2">💡 <strong>ホーム画面に追加する方法</strong></p>
                            <p className="text-xs">Chrome右上のメニュー（⋮）→「ホーム画面に追加」</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<JALSRiskCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
